@model HotelBooking.Web.Areas.Admin.Models.DashboardVM
@using System.Linq
@using System.Globalization

@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

@functions {
    static readonly CultureInfo Usd = CultureInfo.GetCultureInfo("en-US");
    static string FmtUsd(decimal v) => v.ToString("C", Usd);
    string MonthLabel(int y, int m) => new DateTime(y, m, 1).ToString("MMM yyyy");
}

<div class="-mx-6 lg:-mx-8">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="card">
            <div class="card-body">
                <h4 class="text-dark text-lg font-semibold mb-5">Monthly Revenue (Check-In)</h4>
                <div class="flex gap-6 items-center justify-between">
                    <div class="flex flex-col gap-4">
                        @{
                            var months = Model.Last3Months;
                            var current = (months != null && months.Count > 0) ? months[^1] : null;
                        }
                        <h3 class="text-[21px] font-semibold text-dark">
                            @(current is null ? "—" : FmtUsd(current.Revenue))
                        </h3>
                        <div class="flex gap-3 flex-wrap">
                            @foreach (var p in months)
                            {
                                <div class="flex gap-2 items-center">
                                    <span class="w-2 h-2 rounded-full bg-primary"></span>
                                    <p class="text-gray-500 font-normal text-xs">
                                        @MonthLabel(p.Year, p.Month): @FmtUsd(p.Revenue)
                                    </p>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="flex gap-6 items-center justify-between">
                    <div class="flex flex-col gap-5">
                        <h4 class="text-dark text-lg font-semibold">This Week Revenue</h4>
                        <div class="flex flex-col gap-[18px]">
                            <h3 class="text-[21px] font-semibold text-dark">@FmtUsd(Model.WeeklyRevenue)</h3>
                            <div class="text-gray-500 text-sm">Monday–Sunday, confirmed & completed</div>
                        </div>
                    </div>
                    <div class="w-11 h-11 flex justify-center items-center rounded-full bg-info text-white self-start">
                        <i class="ti ti-currency-dollar text-xl"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="mt-6 relative left-1/2 right-1/2 -mx-[50vw] w-screen">
    <div class="px-6 lg:px-8">
        <div class="card">
            <div class="card-body">
                <div class="sm:flex block justify-between mb-5">
                    <div>
                        <h4 class="text-dark text-lg font-semibold sm:mb-0 mb-2">Latest Bookings</h4>
                    </div>
                </div>

                <div class="relative overflow-x-auto">
                    <table class="text-left w-full whitespace-nowrap text-sm my-2.5">
                        <thead class="text-gray-700">
                            <tr class="font-semibold text-dark">
                                <th class="p-4">#</th>
                                <th class="p-4">User</th>
                                <th class="p-4">Hotel / Room</th>
                                <th class="p-4">Dates</th>
                                <th class="p-4">Price</th>
                                <th class="p-4">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var b in Model.Latest)
                            {
                                <tr class="border-b border-gray-400/10">
                                    <td class="p-4">@b.Id</td>
                                    <td class="p-4">
                                        <div class="flex flex-col">
                                            <span class="text-dark font-semibold">
                                                @(string.IsNullOrWhiteSpace(b.UserName) ? "—" : b.UserName)
                                            </span>
                                            <span class="text-xs text-gray-500">@b.UserEmail</span>
                                        </div>
                                    </td>
                                    <td class="p-4">
                                        <div class="flex flex-col">
                                            <span class="text-dark">@b.HotelName</span>
                                            <span class="text-xs text-gray-500">@b.RoomName</span>
                                        </div>
                                    </td>
                                    <td class="p-4">
                                        <span class="text-gray-700">
                                            @b.CheckIn.ToString("yyyy-MM-dd") – @b.CheckOut.ToString("yyyy-MM-dd")
                                        </span>
                                    </td>
                                    <td class="p-4">
                                        <span class="font-semibold text-dark">@FmtUsd(b.TotalPrice)</span>
                                    </td>
                                    <td class="p-4">
                                        @{
                                            var badge = b.Status switch
                                            {
                                                HotelBooking.Domain.Enums.BookingStatus.Pending => "bg-info",
                                                HotelBooking.Domain.Enums.BookingStatus.Confirmed => "bg-primary",
                                                HotelBooking.Domain.Enums.BookingStatus.Completed => "bg-success",
                                                HotelBooking.Domain.Enums.BookingStatus.Cancelled => "bg-error",
                                                _ => "bg-gray-500/30"
                                            };
                                            var text = b.Status.ToString();
                                        }
                                        <span class="inline-flex items-center py-[3px] px-[10px] rounded-md text-white @badge">@text</span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

            </div>
        </div>
    </div>
</div>
